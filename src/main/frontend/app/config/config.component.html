<style>
  .dl-horizontal dt {
    text-align: left;
    padding-top: 5px;
  }

  .dl-horizontal dd {
    padding-top: 5px;
  }
</style>

<div class="container">
  <div class="row">
    <div class="col-md-12">

      <form class="form-horizontal">
        <div class="form-group">
          <div class="col-sm-10">
            <input type="number" class="form-control" ng-model="$ctrl.configId" placeholder="Enter Configuration ID">
          </div>
          <div class="col-sm-2">
            <button type="submit" class="btn btn-primary pull-right" ng-click="$ctrl.runConfig()">
              <i class="glyphicon glyphicon-cog"></i> Run Configuration
            </button>
          </div>
        </div>

        <div class="progressbar" ng-if="$ctrl.configStatus === 'started'">
          <uib-progressbar class="progress-striped active" max="100" value="$ctrl.configProgress.progress">
            <span class="action">
              <i ng-if="$ctrl.configProgress.action">{{$ctrl.configProgress.action}}</i>
              <i ng-if="$ctrl.configProgress.progress">({{$ctrl.configProgress.progress}}%)</i>
            </span>
          </uib-progressbar>
        </div>
      </form>


      <uib-tabset>
        <uib-tab>
          <uib-tab-heading>
            <i class="glyphicon glyphicon-repeat"></i> History
          </uib-tab-heading>

          <table class="table table-striped table-hover">
            <thead>
            <tr>
              <th>Configuration ID</th>
              <th>Configuration Name</th>
              <th>Last Applied On</th>
              <th>Applied By</th>
              <th>Status</th>
              <th></th>
            </tr>
            </thead>

            <tbody>
            <tr ng-repeat="config in $ctrl.history" ng-click="$ctrl.viewConfig(config)">
              <td class="id">{{config.id}}</td>
              <td>{{config.name}}</td>
              <td>{{config.timestamp | date : 'medium'}}</td>
              <td>{{config.user}}</td>
              <td class="cell-label">
                <span ng-if="config.status === 'FAILURE'" class="label label-danger">FAILURE</span>
                <span ng-if="config.status === 'RESTART'" class="label label-warning">RESTART</span>
                <span ng-if="config.status === 'OK'" class="label label-success">OK</span>
              </td>
              <td>
                <button class="btn btn-default btn-xs" ng-click="$ctrl.runConfig(config.id)">
                  <i class="glyphicon glyphicon-refresh"></i>
                </button>
              </td>
            </tr>
            </tbody>
          </table>
        </uib-tab>

        <uib-tab ng-repeat="(configId, reports) in $ctrl.configReports" active="reports[0].active">
          <uib-tab-heading>
        <span ng-if="reports[0].status === 'FAILURE'" class="text-danger">
          <i class="glyphicon glyphicon-remove-sign"></i>
          #{{configId}}
        </span>
        <span ng-if="reports[0].status === 'RESTART'" class="text-warning">
          <i class="glyphicon glyphicon-info-sign"></i>
          #{{configId}}
        </span>
        <span ng-if="reports[0].status === 'OK'" class="text-success">
          <i class="glyphicon glyphicon-ok-sign"></i>
          #{{configId}}
        </span>
          </uib-tab-heading>

          <p>
          <dl class="dl-horizontal">
            <dt>name</dt>
            <dd>{{reports[0].name}}</dd>
            <dt>applied at</dt>
            <dd>{{reports[0].timestamp}}</dd>
            <dt>status</dt>
            <dd>{{reports[0].status}}</dd>
            <dt>message</dt>
            <dd>
              {{reports[0].statusDescription}}
            </dd>
            <dt>DAQs to reboot</dt>
            <dd>{{reports[0].processesToReboot}}</dd>
          </dl>
          </p>

          <uib-tabset>
            <uib-tab>
              <uib-tab-heading>
                <i class="glyphicon glyphicon-repeat"></i> Elements
              </uib-tab-heading>

              <ul class="list-group">
                <li class="list-group-item" ng-repeat="element in reports[0].elementReports">
                  {{::element.action}} {{::element.entity}} #{{::element.id}} {{::element.status}}

                  <div ng-if="element.statusMessage">
                    <pre>{{::element.statusMessage}}</pre>
                  </div>

                  <div ng-if="element.subreports.length > 0">
                    <ul class="list-group">
                      <li class="list-group-item disabled" ng-repeat="subElement in element.subreports">
                        {{::subElement.action}} {{::subElement.entity}} #{{::subElement.id}} {{::subElement.status}}

                        <div ng-if="subElement.statusMessage">
                          <pre>{{::subElement.statusMessage}}</pre>
                        </div>
                      </li>
                    </ul>
                  </div>
                </li>
              </ul>

              <!--<table class="table table-striped table-hover table-condensed">-->
              <!--<thead>-->
              <!--<tr>-->
              <!--<th class="col-sm-3">Action</th>-->
              <!--<th class="col-sm-3">Entity</th>-->
              <!--<th class="col-sm-3">Status</th>-->
              <!--<th class="col-sm-3">Sub elements</th>-->
              <!--</tr>-->
              <!--</thead>-->

              <!--<tbody>-->
              <!--<tr ng-repeat="element in reports[0].elementReports">-->
              <!--<td rowspan="{{element.subreports.length}}">{{element.action}}</td>-->
              <!--<td>{{element.entity}} #{{element.id}}</td>-->
              <!--<td>{{element.status}}</td>-->
              <!--<td>{{element.subreports.length}}</td>-->
              <!--</tr>-->
              <!--</tbody>-->
              <!--</table>-->
            </uib-tab>

          </uib-tabset>

        </uib-tab>
      </uib-tabset>
    </div>
  </div>
</div>